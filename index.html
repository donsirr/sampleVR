<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR GLB Teleport + Movement Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene 
      shadow="type: pcfsoft"
      fog="type: linear; color: #e0e0e0; near: 1; far: 50;"
    >
      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
      <a-entity
        light="type: directional; intensity: 0.5; castShadow: true"
        position="5 5 5"
        target="#cameraRig"
      ></a-entity>
      
      <!-- Camera rig -->
      <a-entity 
        id="cameraRig" 
        position="0 1.6 22.5"
        movement-controls="fly: false; speed: 0"
        gamepad-controls="controller: 0; enableSettings: true"
      >
        <a-camera look-controls position="0 0 0">
          <a-cursor fuse="true" fuse-timeout="500" color="white"></a-cursor>
        </a-camera>

        <!-- Teleport -->
        <a-entity
          teleport-controls="button: trigger; collisionEntities: .teleportable; cameraRig: #cameraRig"
        ></a-entity>
      </a-entity>

      <!-- Ground or environment -->
      

      <!-- GLB Model -->
      <a-entity
        gltf-model="url(klyde the goat 3.glb)"
        position="0 0 0"
        animation-mixer
        scale="1.5 1.5 1.5"
        class="teleportable"
        shadow="cast: true; receive: true"
      ></a-entity>
    </a-scene>

<script>
  // Jump with PS4 X button
  window.addEventListener('gamepadbuttondown', (e) => {
    if (e.detail.index === 0) { // PS4 X button
      const rig = document.querySelector('#cameraRig');
      const pos = rig.getAttribute('position');
      pos.y += 1;
      rig.setAttribute('position', pos);
      setTimeout(() => {
        pos.y -= 1;
        rig.setAttribute('position', pos);
      }, 500);
    }
  });

  // === Continuous Movement Controls ===
  const rig = document.querySelector('#cameraRig');
  const camera = rig.querySelector('a-camera');
  const speed = 0.1; // speed per frame
  let moveDirection = 0; // 1 = forward, -1 = backward, 0 = stop

  function moveRig() {
    if (moveDirection === 0) return;

    const rotation = camera.getAttribute('rotation');
    const angle = THREE.MathUtils.degToRad(rotation.y);
    const dx = -Math.sin(angle) * moveDirection * speed;
    const dz = -Math.cos(angle) * moveDirection * speed;
    const pos = rig.getAttribute('position');
    pos.x += dx;
    pos.z += dz;
    rig.setAttribute('position', pos);
  }

  // Run continuously every frame
  function animate() {
    moveRig();
    requestAnimationFrame(animate);
  }
  animate();

  // --- Mouse Controls ---
  window.addEventListener('mousedown', (e) => {
    if (e.button === 0) moveDirection = 1;   // left click → forward
    if (e.button === 2) moveDirection = -1;  // right click → backward
  });

  window.addEventListener('mouseup', () => moveDirection = 0);
  window.addEventListener('mouseleave', () => moveDirection = 0);
  window.addEventListener('contextmenu', (e) => e.preventDefault());

  // --- Touch Controls (mobile) ---
  window.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) moveDirection = 1;     // one finger → forward
    else if (e.touches.length === 2) moveDirection = -1; // two fingers → backward
  });

  window.addEventListener('touchend', () => moveDirection = 0);
</script>

  </body>
</html>
